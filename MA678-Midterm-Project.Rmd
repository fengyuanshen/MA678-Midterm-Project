---
title: "MA678-Midterm-Project"
output: pdf_document
date: "2023-12-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(stringr)
library(kableExtra)
```

```{r}
listings <- read.csv("data/listings.csv", header = T)
# calendar <- read.csv("data/calendar.csv", header = T)
# reviews <- read.csv("data/reviews.csv", header = T)
```

## Data Cleaning

```{r}
listings_data <- listings |> 
  select(id, host_id, host_name, host_since, host_response_time, host_response_rate,
         host_acceptance_rate, host_is_superhost, host_listings_count, 
         host_identity_verified, latitude, longitude, property_type, room_type,
         accommodates, bathrooms_text, bedrooms, beds, price, minimum_nights,
         maximum_nights, number_of_reviews, review_scores_rating, review_scores_accuracy,
         review_scores_cleanliness, review_scores_checkin, review_scores_communication,
         review_scores_location, review_scores_value, instant_bookable)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# 处理缺失值
listings_data <- listings_data |> drop_na(price)

# 格式化和类型转换
listings_data$price <- as.numeric(str_replace_all(listings_data$price, "\\$", ""))

# 移除重复数据
listings_data <- distinct(listings_data)

# 处理价格中的异常值
Q1 <- quantile(listings_data$price, 0.25, na.rm = TRUE)
Q3 <- quantile(listings_data$price, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1
lower_bound <- Q1 - 1.5 * IQR
upper_bound <- Q3 + 1.5 * IQR
cleaned_data <- listings_data %>% filter(price >= lower_bound & price <= upper_bound)
```

## Heat Map

```{r}
kable(head(listings[,c(1:3,5:7)]))
```

```{r}
# 数据可视化

# 地理位置与价格关系散点图
ggplot(cleaned_data, aes(x=longitude, y=latitude, color=price)) +
  geom_point(alpha=0.5) +
  scale_color_gradient(low="blue", high="red") +
  theme_minimal() +
  labs(title="Geographic Location vs. Price of Airbnb Listings in Los Angeles",
       x="Longitude", y="Latitude")
```

```{r}
# 房源类型分布条形图
# 确保数据集中存在 'room_type' 列
if ("room_type" %in% names(cleaned_data)) {
  ggplot(cleaned_data, aes(x=room_type)) +
    geom_bar() +
    theme_minimal() +
    labs(title="Distribution of Room Types in Airbnb Listings",
         x="Room Type", y="Number of Listings")
}
```

```{r}

# 多变量分析
# 选择适合多变量分析的列
variables_for_pairplot <- c("price", "latitude", "longitude", "number_of_reviews", "review_scores_rating")
cleaned_data %>%
  select(all_of(variables_for_pairplot)) %>%
  drop_na() %>%
  GGally::ggpairs()
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
